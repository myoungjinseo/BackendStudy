# TCP/IP 4계층 모델
 Internet protocol suite : 인터넷에서 서로 정보공유 프로토콜
 <br> ex) TCP/IP 4계층 , OSI 7계층

### 계층구조 

| TCP/IP 4계층 | OSI 7계층                    |
|------------|----------------------------|
| 애플리케이션     | 애플리케이션 <br> 프레젠테이션 <br> 세션 |
| 전송         | 전송                         |
| 인터넷        | 네트워크                       |
| 링크         | 데이터 링크 <br> 물리             |

## 애플리케이션 계층
- FTP : 파일 전송하는데 사용되는 표준 통신 프로토콜
- SSH : 보안되지 않은 네트워크에서 암호화 네트워크 프로토콜
- HTTP : 웹사이트 프로토콜
- SMTP : 이메일을 위한 인터넷 표준 통신 프로토콜
- DNS : 도메인 이름과 IP 주소를 매핑해주는 서버

## 전송 계층
- 송신자와 수신자를 연결하는 통신 서비스를 제공
- 연결 지향 데이터 스트림 지원, 신뢰성, 흐름 제어 제공
- 애플리케이션과 인터넷 계층 사이의 데이터가 전달될 때 중계 역할

### TCP
- 순서를 보장
- 연결지향 프로토콜 사용 : 연결을 하여 신뢰성을 구축, 수신 여부 확인
- 가상회선 패킷 교환 방식 사용 : 각 패킷에 가상회선 식별자가 포함된다. 모든 패킷이 
전송될 경우 가상회선이 해제되어 패킷들을 순서대로 도착하는 방식
- 신뢰성을 확보할 때 3-way handshake 라는 작업 진행
  - SYN 단계 : 클라이언트의 ISN을 담아 SYN을 보냄, ISN은 새로운 TCP 연결의 
  첫 번째 패킷에 할당된 임의의 시퀀스 번호, 장치마다 다를 수 있다.
  - SYN + ACK 단계 : 서버는 클라이언트의 SYN을 받고, 서버의 ISN과 승인번호(클라이언트 ISN +1)을 보냄
  - ACK 단계 : 승인번호(서버의 ISN +1)을 서버에 보냄
  - SYN : 연결 요청 플래그, ACK : 응답 플래그, ISN : 초기 네트워크 연결을 할 때 할당된 32비트 고유 시퀀스 번호
- TCP 연결 해제 과정 : 4-way handshake
  1. 클라이언트에서 FIN으로 설정된 세그먼트 보내고, FIN_WAIT_1 상태로 들가고, 서버 응답 기다림
  2. 서버는 클라이언트로 ACK라는 승인 세그먼트 보냄, CLOSE_WAIT 상태로 들가고,
  클라이언트가 세그먼트 받으면 클라이언트는 FIN_WAIT_2 상태에 들감
  3. 서버는 ACK를 보내고 일정 시간 이후에 FIN이라는 세그먼트를 보냄
  4. 클라이언트는 TIME_WAIT 상태가 되고, 서버한테 ACK를 보냄, 서버는 CLOSED 상태가 되고, 
  어느정도 시간을 대기한 후 연결이 닫히고 CLOSED가 됨
  - TIME_WAIT 
    - 소켓이 바로 소멸되지 않고 일정 시간 유지되는 상태
    - 일정시간 뒤에 닫히는 이유
      - 지연 패킷 발생 대비 : 패킷이 뒤늦게 도달하고 이를 처리하지 못하며 데이터 무결성 문제 발생
      - 두 장치 연결 닫혔는지 확인하기 위해 : 만약에 LAST_ACK 상태에서 닫히게 되면 새로운 연결 시 접속 오류 발생  
    - CentOS6, 우분투는 60초, 윈도우 4분으로 설정되어 있다, OS마다 다를 수 있음
  - 데이터 무결성 : 데이터의 정확성과 일관성을 유지하고 보증하는 것
### UDP
- 순서를 보장하지 않음
- 수신 여부 확인하지 않음
- 데이터그램 패킷 교환 방식 사용 : 패킷이 독립적으로 이동하며 최적의 경로를 선택하여 감, 
하나의 메시지에서 분할된 여러 패킷은 서로 다른 경로로 전송되어 순서가 다를 수 있는 방식 

## 인터넷 계층 
- 장치로부터 받은 네트워크 패킷을 IP 주소로 지정된 목적지로 전송하기 위해 사용되는 계층
- IP, ARP, ICMP 등 있음
- 패킷을 수신해야 할 상대의 주소를 지정하여 데이터 전달
- 상대방이 제대로 받았는지에 대해 보장하지 않는 빙ㄴ결형저인 특징을 가짐

## 링크 계층 (네트워크 접근 계층)
- 데이터를 전달하며 장치 간에 신호를 주고받는 규칙을 정하는 계층
- 계층을 나누게 될 경우 물리 계층(데이터 보내는 계층, 유선 LAN or 무선 LAN 이용),
데이터 링크 계층(에러 확인, 흐름제어, 접근 제어 담당 계층, 이더넷 프레임 이용)
- 유선 LAN을 이루는 이더넷 :  IEEE802.3 프로토콜 따름, 전이중화 통신 사용
  - 전이중화 통신 : 양쪽 장치가 동시에 송수신할 수 있는 방식, 송신로, 수신로 나눠서 통신, 현재 고속 이더넷 방식이 이 방식을 기반으로 함
  - CSMA/CD 
    - 이전 유선 LAN
    - 반이중화 통신
    - 데이터를 보낸 이후 충돌 발생 시 일정 시간 이후 재전송
    - 송신로, 수신로를 한 경로에 둠
  - 유선 LAN을 이루는 케이블
    - TP 케이블(트워스트 페어 케이블)
      - 여덟 개의 구리선을 두 개씩 꼬아서 묶은 케이블
      - UTP케이블 (구리선을 실드 처리하지 않고 덮으면 흔히 LAN 케이블(커넥터 = RJ-45)이라고 사용), 
      STP케이블(실드 처리하고 덮음) 
    - 광섬유 케이블
        - 광섬유로 만든 케이블
        - 장거리 및 고속 통신 가능
        - 광섬유 내부와 외부를 다른 밀도를 가지는 유리나 플라스틱 섬유로 제작, 빛이 내부에서 계속 반사하여 전진하여 보내는 원리
          - 코어(빛의 굴절률이 높은 부분), 클래딩(낮은 부분)
  - 무선 LAN : 수신과 송신에 같은 채널을 사용
    - 반이중화 통신 : 한번에 한 방향만 통신할 수 있는 방법